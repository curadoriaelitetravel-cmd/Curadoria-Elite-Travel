<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Curadoria Elite Travel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body{
      margin:0;
      font-family:"Segoe UI",sans-serif;
      background:#0b0b0b;
      color:#fff;
      overflow-x:hidden;
    }

    header{
      padding:16px 40px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:fixed;
      width:100%;
      top:0;
      z-index:1000;
      background:rgba(0,0,0,0.25);
      backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,0.06);
      box-sizing:border-box;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }

    .brand img{
      height:34px;
      width:34px;
    }

    .brand-name{
      font-family:"Cinzel","Georgia",serif;
      font-size:18px;
      color:#d4af37;
      letter-spacing:0.8px;
      text-transform:uppercase;
      line-height:1.1;
    }

    .brand-tagline{
      font-size:12px;
      color:rgba(255,255,255,0.7);
      line-height:1.2;
      margin-top:2px;
    }

    nav a{
      margin-left:20px;
      color:#d4af37;
      text-decoration:none;
      font-weight:500;
      cursor:pointer;
      white-space: nowrap;
    }

    section{
      display:none;
      padding:120px 40px 80px;
      max-width:1100px;
      margin:auto;
      box-sizing:border-box;
    }

    section.active{ display:block; }

    footer{
      border-top:1px solid #222;
      padding:30px;
      text-align:center;
      color:#888;
      font-size:14px;
    }

    /* ========= HOME (Hero) ========= */
    #inicio{
      padding:0;
      max-width:none;
    }

    .hero{
      height:100vh;
      position:relative;
      overflow:hidden;
      background:#0b0b0b;
    }

    .hero-bg{
      position:absolute;
      inset:0;
      background-size:cover;
      background-position:center;
      filter:brightness(0.42) saturate(0.6);
      opacity:0;
      transition:opacity 3s ease;
      transform:scale(1.03);
    }

    .hero-bg.active{ opacity:1; }

    .hero-overlay{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.68);
    }

    .hero-content{
      position:relative;
      z-index:2;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:20px;
      box-sizing:border-box;
    }

    .hero-content h1{
      color:#d4af37;
      font-size:clamp(28px,4vw,52px);
      margin:0 0 12px;
    }

    .hero-content p{
      color:rgba(255,255,255,0.85);
      margin:6px 0;
      font-size:15px;
      line-height:1.6;
    }

    /* ========= QUEM SOMOS (painéis laterais + regras) ========= */
    #quem{
      max-width:none;
      padding-left:0;
      padding-right:0;
    }

    .about-layout{
      display:grid;
      grid-template-columns:minmax(260px,1fr) minmax(520px,760px) minmax(260px,1fr);
      gap:26px;
      align-items:stretch;
      padding:0 40px;
      box-sizing:border-box;
    }

    .about-center{
      display:flex;
      flex-direction:column;
    }

    .about-center h2{
      text-align:center;
      color:#d4af37;
      margin:40px 0 34px;
      font-size:28px;
      letter-spacing:0.2px;
    }

    .text-block{
      color:#ddd;
      font-size:15px;
      line-height:1.7;
      max-width:760px;
      margin:0 auto 54px;
      text-align:center;
    }

    .rules-block{
      background:#111;
      border:1px solid #222;
      border-radius:14px;
      padding:30px;
      max-width:760px;
      margin:0 auto;
      font-size:14px;
      line-height:1.6;
      color:#ccc;
    }

    .rules-block strong{
      color:#d4af37;
      font-weight:700;
    }

    .rules-block .hl{
      color:#d4af37;
      font-weight:600;
    }

    .side-panel{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid #222;
      background:#0b0b0b;
      margin-top:92px;
      height:calc(100% - 92px);
    }

    .side-panel-inner{
      position:absolute;
      inset:0;
    }

    .side-bg{
      position:absolute;
      inset:0;
      background-size:cover;
      opacity:0;
      transition:opacity 3.2s ease;
      transform:scale(1.02);
      filter:brightness(0.72) saturate(0.9) contrast(0.95);
    }

    .side-bg.active{ opacity:1; }
    .side-bg.left{ background-position:left center; }
    .side-bg.right{ background-position:right center; }

    .side-overlay{
      position:absolute;
      inset:0;
      background:linear-gradient(
        180deg,
        rgba(0,0,0,0.42) 0%,
        rgba(0,0,0,0.58) 55%,
        rgba(0,0,0,0.72) 100%
      );
      pointer-events:none;
    }

    .side-caption{
      position:absolute;
      left:18px;
      bottom:16px;
      z-index:3;
      color:rgba(255,255,255,0.78);
      font-size:12.5px;
      letter-spacing:0.2px;
    }

    /* ========= CURADORIA (hub) ========= */
    #curadoria h2{
      text-align:center;
      color:#d4af37;
      margin:40px 0 14px;
      font-size:28px;
      letter-spacing:0.2px;
    }

    .subtitle{
      text-align:center;
      color:rgba(255,255,255,0.78);
      max-width:860px;
      margin:0 auto 34px;
      line-height:1.6;
      font-size:15px;
    }

    .card{
      background:linear-gradient(145deg,#111,#000);
      border:1px solid #222;
      border-radius:14px;
      padding:22px;
      transition:all 0.35s ease;
      position:relative;
    }

    .card:hover{
      transform:translateY(-4px);
      border-color:#d4af37;
      box-shadow:0 10px 20px rgba(212,175,55,0.20);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:22px;
      margin-top:18px;
    }

    .card img{
      width:100%;
      height:150px;
      object-fit:cover;
      border-radius:10px;
      margin-bottom:12px;
      filter:brightness(0.82) saturate(0.9);
    }

    .card h3{
      margin:6px 0 8px;
      color:#d4af37;
      font-size:18px;
      letter-spacing:0.2px;
    }

    .card p{
      margin:0;
      color:rgba(255,255,255,0.75);
      font-size:13.8px;
      line-height:1.5;
    }

    button{
      cursor:pointer;
      padding:10px 16px;
      border-radius:10px;
      border:none;
      background:#d4af37;
      color:#000;
      font-weight:700;
      margin-top:14px;
    }

    .btn-ghost{
      background:transparent;
      border:1px solid rgba(212,175,55,0.35);
      color:#d4af37;
      font-weight:600;
    }

    /* Painel interno: visual mais premium e organizado */
    .curadoria-panel{
      display:none;
      margin-top:26px;
      border-radius:16px;
      border:1px solid rgba(212,175,55,0.22);
      background:linear-gradient(145deg,#0f0f0f,#0a0a0a);
      padding:18px;
    }

    .panel-top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .breadcrumb{
      color:rgba(255,255,255,0.72);
      font-size:13px;
      margin-bottom:6px;
    }

    .panel-title{
      color:#d4af37;
      font-size:20px;
      margin:0;
      letter-spacing:0.2px;
    }

    .panel-meta{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid #222;
      background:#0f0f0f;
      color:rgba(255,255,255,0.75);
      font-size:12.5px;
      line-height:1;
    }

    .pill.ok{
      border-color: rgba(212,175,55,0.35);
      color:#d4af37;
    }

    .pill.muted{
      border-color: rgba(255,255,255,0.10);
      color: rgba(255,255,255,0.62);
    }

    .search-wrap{
      flex:1;
      min-width: 240px;
      max-width: 520px;
      position:relative;
    }

    .search-input{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #222;
      background:#0f0f0f;
      color:#fff;
      outline:none;
      box-sizing:border-box;
      font-size:14px;
    }

    .search-input::placeholder{
      color:rgba(255,255,255,0.45);
    }

    .panel-actions{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    .cities-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:16px;
    }

    .city-card{
      background:#0f0f0f;
      border:1px solid #222;
      border-radius:14px;
      padding:16px;
      text-align:left;
      transition:all 0.3s ease;
      position:relative;
    }

    .city-card:hover{
      transform:translateY(-3px);
      border-color:rgba(212,175,55,0.55);
    }

    .city-card h4{
      margin:0 0 10px;
      color:#fff;
      font-weight:650;
      font-size:15px;
      line-height:1.3;
    }

    .city-card small{
      display:block;
      color:rgba(255,255,255,0.6);
      margin-top:2px;
      font-size:12px;
    }

    .city-meta{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
      margin-bottom:8px;
    }

    .panel-footer{
      margin-top:14px;
      display:flex;
      justify-content:center;
    }

    .empty-state{
      text-align:center;
      color:rgba(255,255,255,0.68);
      border:1px dashed rgba(255,255,255,0.12);
      border-radius:14px;
      padding:22px 16px;
      margin-top:14px;
      font-size:14px;
      line-height:1.6;
    }

    /* ========= CONTATO & AVALIAÇÕES ========= */
    #contato{
      max-width:none;
      padding-left:0;
      padding-right:0;
    }

    .contact-center{
      display:flex;
      flex-direction:column;
      padding:0 40px;
      box-sizing:border-box;
    }

    .contact-center h2{
      text-align:center;
      color:#d4af37;
      margin:40px 0 34px;
      font-size:28px;
      letter-spacing:0.2px;
    }

    .contact-sub{
      color:rgba(255,255,255,0.78);
      font-size:15px;
      line-height:1.7;
      text-align:center;
      max-width:760px;
      margin:0 auto 22px;
    }

    .contact-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:18px;
      max-width:760px;
      margin:0 auto;
    }

    .contact-card{
      background:#111;
      border:1px solid #222;
      border-radius:14px;
      padding:22px;
    }

    .contact-card h3{
      margin:0 0 10px;
      color:#d4af37;
      font-size:18px;
      letter-spacing:0.2px;
      text-align:left;
    }

    .contact-line{
      color:rgba(255,255,255,0.82);
      font-size:14px;
      line-height:1.7;
      text-align:left;
    }

    .contact-link{
      color:#d4af37;
      text-decoration:none;
      border-bottom:1px solid rgba(212,175,55,0.28);
      padding-bottom:1px;
    }

    .form-label{
      display:block;
      text-align:left;
      color:rgba(255,255,255,0.78);
      font-size:12.5px;
      margin:12px 0 8px;
    }

    .form-input, .form-textarea, .form-select{
      width:100%;
      border-radius:12px;
      border:1px solid #222;
      background:#0f0f0f;
      color:#fff;
      outline:none;
      box-sizing:border-box;
      font-size:14px;
      padding:12px 14px;
    }

    .form-textarea{
      min-height:120px;
      resize:vertical;
      line-height:1.6;
    }

    .stars{
      display:flex;
      gap:8px;
      justify-content:flex-start;
      margin-top:8px;
      user-select:none;
    }

    .star{
      font-size:20px;
      cursor:pointer;
      color:rgba(255,255,255,0.25);
      transition:transform 0.15s ease, color 0.15s ease;
    }

    .star:hover{
      transform:translateY(-1px);
    }

    .star.on{
      color:#d4af37;
    }

    .small-note{
      margin-top:10px;
      color:rgba(255,255,255,0.6);
      font-size:12.5px;
      line-height:1.5;
      text-align:left;
    }

    @media (max-width:980px){
      .contact-grid{
        grid-template-columns:1fr;
      }
      .contact-center{
        padding:0 16px;
      }
    }

    /* ========= POPUPS ========= */
    .popup-bg{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:3000;
      padding:18px;
      box-sizing:border-box;
    }

    .popup-bg.active{ display:flex; }

    .popup-content{
      background:#111;
      border:1px solid #222;
      border-radius:14px;
      max-width:720px;
      width:100%;
      padding:24px;
      box-sizing:border-box;
      position:relative;
      text-align:center;
    }

    .popup-content h3{
      margin:0 0 10px;
      color:#d4af37;
      letter-spacing:0.2px;
    }

    .popup-content p{
      margin:0 0 14px;
      color:rgba(255,255,255,0.8);
      line-height:1.6;
      font-size:14px;
    }

    .popup-actions{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .popup-rules{
      text-align:left;
      margin-top:14px;
      background:#0f0f0f;
      border:1px solid #222;
      border-radius:12px;
      padding:16px;
      color:rgba(255,255,255,0.78);
      font-size:13.5px;
      line-height:1.6;
    }

    .popup-rules strong{ color:#d4af37; }

    /* Checkbox antes do Prosseguir */
    .consent-wrap{
      display:flex;
      gap:10px;
      align-items:flex-start;
      margin-top:12px;
      text-align:left;
      padding:12px;
      border:1px solid #222;
      border-radius:12px;
      background:#0f0f0f;
      color:rgba(255,255,255,0.82);
      font-size:13.2px;
      line-height:1.55;
    }

    .consent-wrap input{
      margin-top:3px;
      accent-color:#d4af37;
    }

    /* Responsivo */
    @media (max-width:980px){
      header{ padding:14px 16px; }
      nav a{ margin-left:14px; }
      section{ padding:110px 16px 70px; }

      .about-layout{
        grid-template-columns:1fr;
        padding:0 16px;
        gap:16px;
        align-items:start;
      }

      .side-panel{ height:240px; margin-top:0; }
      .side-bg.left,.side-bg.right{ background-position:center; }
      .brand{ min-width: auto; }

      .curadoria-panel{
        padding:16px;
      }
      .panel-top{
        align-items:flex-start;
      }
      .search-wrap{
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <img src="images/rosa-dos-ventos.png" alt="Rosa dos Ventos">
    <div>
      <div class="brand-name">Curadoria Elite Travel</div>
      <div class="brand-tagline">O seu mundo, bem indicado.</div>
    </div>
  </div>

  <nav>
    <a onclick="showSection('inicio')">Início</a>
    <a onclick="showSection('quem')">Quem Somos</a>
    <a onclick="showSection('curadoria')">Curadoria</a>
    <a onclick="showSection('buscador')">Buscador</a>
    <a onclick="showSection('contato')">Contato</a>

    <a id="nav-entrar" onclick="goLogin()">Entrar</a>
    <a id="nav-conta" style="display:none;" onclick="goAccount()">Minha conta</a>
    <a id="nav-sair" style="display:none;" onclick="doLogout()">Sair</a>
  </nav>
</header>

<!-- INÍCIO -->
<section id="inicio" class="active">
  <div class="hero">
    <div class="hero-bg active" id="bg1"></div>
    <div class="hero-bg" id="bg2"></div>
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <div>
        <h1>Uma plataforma de curadoria para viajar melhor.</h1>
        <p>Curadoria que orienta. Decisão que flui.</p>
        <p>Selecionamos e organizamos informações essenciais para decisões de viagem mais seguras e bem fundamentadas.</p>
      </div>
    </div>
  </div>
</section>

<!-- QUEM SOMOS -->
<section id="quem">
  <div class="about-layout">

    <div class="side-panel" aria-hidden="true">
      <div class="side-panel-inner">
        <div class="side-bg left active" id="sl1"></div>
        <div class="side-bg left" id="sl2"></div>
        <div class="side-overlay"></div>
        <div class="side-caption">Critério · Orientação · Decisão</div>
      </div>
    </div>

    <div class="about-center">
      <h2>Quem Somos</h2>

      <div class="text-block">
        Na Curadoria Elite Travel, acreditamos que o tempo é um dos bens mais valiosos de quem viaja.<br><br>
        Em um cenário onde a praticidade digital é essencial, percebemos que o viajante moderno buscava autonomia sem abrir mão de inspiração, critério e confiança - uma forma clara e organizada de decidir melhor, que ainda não existia.<br><br>
        Foi dessa necessidade que nascemos. A Curadoria Elite Travel é uma plataforma criada para organizar informações e oferecer indicações criteriosas, transformando destinos em universos referenciados e acessíveis digitalmente.<br><br>
        Nossa curadoria é composta por indicações, referências e orientações práticas, pensadas para apoiar decisões de viagem antes e durante a experiência.<br><br>
        Não somos uma agência de viagens e não realizamos reservas. Nosso papel é selecionar, estruturar e apresentar conhecimento de qualidade para quem prefere decidir com segurança e clareza.<br><br>
        <strong>O seu mundo, bem indicado.</strong>
      </div>

      <div class="rules-block">
        <strong>Informações Importantes</strong><br><br>

        A Curadoria Elite Travel oferece exclusivamente materiais digitais de caráter informativo e orientativo, baseados em indicações, referências e conteúdos selecionados.<br><br>

        Não realizamos reservas, vendas de passagens, hospedagens, experiências ou qualquer tipo de intermediação direta com fornecedores ou prestadores de serviço.<br><br>

        As decisões de compra, contratação e utilização de serviços indicados nos materiais são de <span class="hl">responsabilidade exclusiva do usuário</span>, assim como qualquer tratativa, solicitação, alteração ou eventual problema relacionado aos serviços contratados.<br><br>

        Por se tratar de conteúdo digital disponibilizado de forma imediata após a confirmação da compra, <span class="hl">não é possível realizar cancelamentos, trocas ou reembolsos</span>.<br><br>

        Ao adquirir nossos materiais, o usuário declara estar ciente e de acordo com essas condições.
      </div>
    </div>

    <div class="side-panel" aria-hidden="true">
      <div class="side-panel-inner">
        <div class="side-bg right active" id="sr1"></div>
        <div class="side-bg right" id="sr2"></div>
        <div class="side-overlay"></div>
      </div>
    </div>

  </div>
</section>

<!-- CURADORIA -->
<section id="curadoria">
  <h2>Curadoria</h2>
  <p class="subtitle">
    Materiais digitais desenvolvidos para apoiar decisões de viagem com critério, clareza e indicações bem organizadas.
  </p>

  <!-- Overview -->
  <div class="card" style="text-align:center; max-width:900px; margin:0 auto;">
    <h3 style="margin-top:0;">Overview</h3>
    <p>Conheça o formato, a profundidade e o padrão dos materiais que entregamos.</p>
    <button onclick="openOverview()">Abrir overview</button>
  </div>

  <!-- Grid de categorias -->
  <div id="curadoria-categories" class="grid" style="margin-top:26px;">
    <div class="card" onclick="openCategory('City Guide')">
      <img src="https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1200&q=80">
      <h3>City Guide</h3>
      <p>Indicações essenciais por destino, com foco em clareza e praticidade.</p>
    </div>

    <div class="card" onclick="openCategory('Gastronomia')">
      <img src="https://images.unsplash.com/photo-1528605248644-14dd04022da1?auto=format&fit=crop&w=1200&q=80">
      <h3>Gastronomia</h3>
      <p>Seleções gastronômicas para decisões mais seguras e bem orientadas.</p>
    </div>

    <div class="card" onclick="openCategory('Atrações Turísticas')">
      <img src="https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?auto=format&fit=crop&w=1200&q=80">
      <h3>Atrações Turísticas</h3>
      <p>O que vale seu tempo - com contexto e organização por destino.</p>
    </div>

    <div class="card" onclick="openCategory('Vida Noturna')">
      <img src="https://images.unsplash.com/photo-1506157786151-b8491531f063?auto=format&fit=crop&w=1200&q=80">
      <h3>Vida Noturna</h3>
      <p>Locais e experiências noturnas com curadoria e referências.</p>
    </div>

    <div class="card" onclick="openCategory('Endereços para Compras')">
      <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=1200&q=80">
      <h3>Endereços para Compras</h3>
      <p>Lojas, regiões e referências para comprar bem e com intenção.</p>
    </div>

    <div class="card" onclick="openCategory('Sugestão de Presentes')">
      <img src="https://images.unsplash.com/photo-1512909006721-3d6018887383?auto=format&fit=crop&w=1200&q=80">
      <h3>Sugestão de Presentes</h3>
      <p>Ideias e recomendações para presentes com bom senso e estilo.</p>
    </div>
  </div>

  <!-- Painel interno -->
  <div id="curadoria-panel" class="curadoria-panel">
    <div class="panel-top">
      <div>
        <div class="breadcrumb" id="breadcrumb">Curadoria</div>
        <h3 class="panel-title" id="panel-title">Categoria</h3>
        <div class="panel-meta">
          <span class="pill" id="cities-count">0 cidades</span>
          <span class="pill" id="visible-count">Mostrando 0</span>
          <span class="pill muted" id="admin-status">Admin: carregando...</span>
        </div>
      </div>

      <div class="panel-actions">
        <div class="search-wrap">
          <input
            id="city-search"
            class="search-input"
            type="text"
            placeholder="Buscar cidade..."
            oninput="onSearchCity()"
          />
        </div>
        <button class="btn-ghost" onclick="closeCategory()">← Voltar</button>
      </div>
    </div>

    <div id="cities-grid" class="cities-grid"></div>

    <div id="empty-state" class="empty-state" style="display:none;">
      Nenhum resultado encontrado.
    </div>

    <div class="panel-footer">
      <button id="btn-more" class="btn-ghost" style="display:none;" onclick="loadMoreCities()">
        Ver mais cidades
      </button>
    </div>
  </div>
</section>

<!-- BUSCADOR -->
<section id="buscador">
  <h2 style="text-align:center;color:#d4af37;margin:40px 0 14px;">Buscador</h2>
  <p class="subtitle">Em breve: área integrada com buscadores e indicações.</p>
</section>

<!-- CONTATO -->
<section id="contato">
  <div class="contact-center">
    <h2>Contato e Avaliação</h2>
    <p class="contact-sub">
      Para dúvidas, sugestões ou feedback, fale conosco. Sua avaliação nos ajuda a manter o padrão e evoluir a plataforma.
    </p>

    <div class="contact-grid">
      <div class="contact-card">
        <h3>Contato</h3>
        <div class="contact-line">
          E-mail: <a class="contact-link" href="mailto:curadoriaelitetravel@gmail.com">curadoriaelitetravel@gmail.com</a><br>
          São Paulo - SP
        </div>
      </div>

      <div class="contact-card">
        <h3>Avaliação</h3>

        <label class="form-label">Seu nome</label>
        <input class="form-input" id="fb-name" type="text" placeholder="Digite seu nome" />

        <label class="form-label">Sua mensagem</label>
        <textarea class="form-textarea" id="fb-message" placeholder="Conte como foi sua experiência"></textarea>

        <label class="form-label">Nota</label>
        <div class="stars" id="stars">
          <span class="star" data-v="1">★</span>
          <span class="star" data-v="2">★</span>
          <span class="star" data-v="3">★</span>
          <span class="star" data-v="4">★</span>
          <span class="star" data-v="5">★</span>
        </div>

        <div class="small-note">
          (A avaliação é apenas informativa e pode ser coletada por formulário/integração posteriormente.)
        </div>

        <button class="btn-ghost" onclick="fakeSendFeedback()">Enviar</button>
      </div>
    </div>
  </div>
</section>

<footer>
  Curadoria Elite Travel · O seu mundo, bem indicado.<br>
  São Paulo - SP · curadoriaelitetravel@gmail.com
</footer>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  /* =========================
     Navegação entre seções
  ========================= */
  function showSection(id){
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    const el = document.getElementById(id);
    if (el) el.classList.add("active");
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  /* =========================
     HERO / BACKGROUNDS ROTATION
  ========================= */
  function setBg(elId, url){
    const el = document.getElementById(elId);
    if (!el) return;
    el.style.backgroundImage = "url('" + url + "')";
  }

  function rotateTwo(aId, bId, intervalMs){
    let onA = true;
    setInterval(() => {
      const a = document.getElementById(aId);
      const b = document.getElementById(bId);
      if (!a || !b) return;
      onA = !onA;
      if (onA){
        a.classList.add("active");
        b.classList.remove("active");
      } else {
        b.classList.add("active");
        a.classList.remove("active");
      }
    }, intervalMs);
  }

  function initBackgrounds(){
    // HERO
    setBg("bg1", "https://images.unsplash.com/photo-1500375592092-40eb2168fd21?auto=format&fit=crop&w=1600&q=80");
    setBg("bg2", "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=1600&q=80");
    rotateTwo("bg1","bg2", 6500);

    // LEFT PANEL
    setBg("sl1", "https://images.unsplash.com/photo-1526778548025-fa2f459cd5c1?auto=format&fit=crop&w=1200&q=80");
    setBg("sl2", "https://images.unsplash.com/photo-1526481280695-3c687fd5432c?auto=format&fit=crop&w=1200&q=80");
    rotateTwo("sl1","sl2", 7800);

    // RIGHT PANEL
    setBg("sr1", "https://images.unsplash.com/photo-1502602898657-3e91760cbb34?auto=format&fit=crop&w=1200&q=80");
    setBg("sr2", "https://images.unsplash.com/photo-1522098543979-ffc7f79f3e6f?auto=format&fit=crop&w=1200&q=80");
    rotateTwo("sr1","sr2", 8200);
  }

  /* =========================
     Popup
  ========================= */
  function ensurePopupExists(){
    if (document.getElementById("popup")) return;

    const popupHTML = `
      <div class="popup-bg" id="popup">
        <div class="popup-content" id="popup-content">
          <h3 id="popup-title"></h3>
          <p id="popup-text"></p>

          <div class="popup-rules" id="popup-rules" style="display:none;">
            <strong>Informações Importantes</strong><br><br>
            A Curadoria Elite Travel oferece exclusivamente materiais digitais de caráter informativo e orientativo, baseados em indicações, referências e conteúdos selecionados.<br><br>
            Não realizamos reservas, vendas de passagens, hospedagens, experiências ou qualquer tipo de intermediação direta com fornecedores ou prestadores de serviço.<br><br>
            As decisões de compra, contratação e utilização de serviços indicados nos materiais são de <strong>responsabilidade exclusiva do usuário</strong>, assim como qualquer tratativa, solicitação, alteração ou eventual problema relacionado aos serviços contratados.<br><br>
            Por se tratar de conteúdo digital disponibilizado de forma imediata após a confirmação da compra, <strong>não é possível realizar cancelamentos, trocas ou reembolsos</strong>.<br><br>
            Ao adquirir nossos materiais, o usuário declara estar ciente e de acordo com essas condições.
          </div>

          <div class="popup-actions">
            <button id="popup-prosseguir" style="display:none;">Prosseguir</button>
            <button class="btn-ghost" id="popup-fechar">Fechar</button>
          </div>
        </div>
      </div>
    `;

    const wrap = document.createElement("div");
    wrap.innerHTML = popupHTML;
    document.body.appendChild(wrap);

    document.getElementById("popup-fechar").addEventListener("click", closePopup);
  }

  function openPopup({ title="", text="", showProsseguir=false, showRules=false, onProsseguir=null }){
    ensurePopupExists();

    document.getElementById("popup-title").innerText = title;
    document.getElementById("popup-text").innerText = text;

    const rules = document.getElementById("popup-rules");
    rules.style.display = showRules ? "block" : "none";

    const btn = document.getElementById("popup-prosseguir");
    btn.style.display = showProsseguir ? "inline-block" : "none";

    // remove checkbox antigo (se tiver)
    const old = document.getElementById("consent-checkbox-wrap");
    if (old) old.remove();

    // Se for comprar (Prosseguir aparece), então adiciona o checkbox e trava o botão
    if (showProsseguir){
      const actions = document.querySelector("#popup-content .popup-actions");

      const consentWrap = document.createElement("div");
      consentWrap.id = "consent-checkbox-wrap";
      consentWrap.className = "consent-wrap";
      consentWrap.innerHTML = `
        <input type="checkbox" id="consent-checkbox" />
        <label for="consent-checkbox">(Li e concordo que, por ser um produto digital de acesso imediato, não será possível realizar cancelamentos, trocas ou reembolsos após a confirmação da compra.)</label>
      `;

      // Insere o checkbox acima dos botões
      actions.parentNode.insertBefore(consentWrap, actions);

      btn.disabled = true;

      const cb = document.getElementById("consent-checkbox");
      cb.addEventListener("change", () => {
        btn.disabled = !cb.checked;
      });
    } else {
      btn.disabled = false;
    }

    // comportamento do Prosseguir
    btn.onclick = null;
    if (showProsseguir && typeof onProsseguir === "function"){
      btn.onclick = onProsseguir;
    }

    document.getElementById("popup").classList.add("active");
  }

  function closePopup(){
    const p = document.getElementById("popup");
    if (p) p.classList.remove("active");

    const old = document.getElementById("consent-checkbox-wrap");
    if (old) old.remove();

    const btn = document.getElementById("popup-prosseguir");
    if (btn) btn.disabled = false;
  }

  /* =========================
     Overview
  ========================= */
  function openOverview(){
    window.location.href = "https://lnyoqoezezisakghtmim.supabase.co/storage/v1/object/public/materiais/overview/general-overview.pdf";
  }

  /* =========================
     Dados das cidades
  ========================= */
  const curadoriaData = {
    "City Guide": [
      { cidade: "São Paulo - Brasil" },
      { cidade: "Rio de Janeiro - Brasil" },
      { cidade: "Paris - França" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Roma - Itália" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "Tóquio - Japão" },
      { cidade: "Dubai - Emirados Árabes" },
      { cidade: "Barcelona - Espanha" },
      { cidade: "Lisboa - Portugal" }
    ],
    "Gastronomia": [
      { cidade: "São Paulo - Brasil" },
      { cidade: "Rio de Janeiro - Brasil" },
      { cidade: "Paris - França" },
      { cidade: "Roma - Itália" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "Barcelona - Espanha" },
      { cidade: "Lisboa - Portugal" }
    ],
    "Atrações Turísticas": [
      { cidade: "Paris - França" },
      { cidade: "Roma - Itália" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Pequim - China" },
      { cidade: "Kyoto - Japão" },
      { cidade: "Barcelona - Espanha" },
      { cidade: "Lisboa - Portugal" }
    ],
    "Vida Noturna": [
      { cidade: "São Paulo - Brasil" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "Rio de Janeiro - Brasil" },
      { cidade: "Barcelona - Espanha" },
      { cidade: "Berlim - Alemanha" }
    ],
    "Endereços para Compras": [
      { cidade: "São Paulo - Brasil" },
      { cidade: "Paris - França" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "Milão - Itália" },
      { cidade: "Dubai - Emirados Árabes" }
    ],
    "Sugestão de Presentes": [
      { cidade: "Paris - França" },
      { cidade: "Roma - Itália" },
      { cidade: "NEW YORK - USA" },
      { cidade: "Londres - Reino Unido" },
      { cidade: "Lisboa - Portugal" }
    ]
  };

  /* =========================
     Supabase
  ========================= */
  const SUPABASE_URL = "https://lnyoqoezezisakghtmim.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxueW9xb2V6ZXppc2FrZ2h0bWltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNjI4OTMsImV4cCI6MjA3OTczODg5M30.Nn9ZPRXeJlvCGJ2kXQ3XBvT743pQn2VIXEsT9pexqnA";

  let supabaseClient = null;

  function ensureSupabase(){
    if (supabaseClient) return supabaseClient;
    if (!window.supabase) return null;
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    return supabaseClient;
  }

  async function getAccessToken(){
    const sb = ensureSupabase();
    if (!sb) return null;
    const { data } = await sb.auth.getSession();
    return (data && data.session && data.session.access_token) ? data.session.access_token : null;
  }

  async function isLoggedIn(){
    const t = await getAccessToken();
    return !!t;
  }

  async function updateAuthLinks(){
    const entrar = document.getElementById("nav-entrar");
    const conta = document.getElementById("nav-conta");
    const sair = document.getElementById("nav-sair");

    const logged = await isLoggedIn();

    if (entrar) entrar.style.display = logged ? "none" : "inline";
    if (conta) conta.style.display = logged ? "inline" : "none";
    if (sair) sair.style.display = logged ? "inline" : "none";
  }

  function goLogin(){
    window.location.href = "login.html?return_to=index.html";
  }

  function goAccount(){
    window.location.href = "account.html";
  }

  async function doLogout(){
    try{
      const sb = ensureSupabase();
      if (sb) await sb.auth.signOut();
    }catch(e){}
    await updateAuthLinks();
    openPopup({
      title: "Sessão",
      text: "Você saiu da sua conta.",
      showProsseguir: false,
      showRules: false
    });
  }

  /* =========================
     Pending checkout (retomar)
  ========================= */
  function savePendingCheckout(category, city){
    try{
      localStorage.setItem("pending_checkout", JSON.stringify({ category, city, at: Date.now() }));
    }catch(e){}
  }

  function readPendingCheckout(){
    try{
      const raw = localStorage.getItem("pending_checkout");
      if (!raw) return null;
      return JSON.parse(raw);
    }catch(e){
      return null;
    }
  }

  function clearPendingCheckout(){
    try{ localStorage.removeItem("pending_checkout"); }catch(e){}
  }

  /* =========================
     Disponibilidade (NORMALIZAÇÃO forte)
     - resolve sumiço por diferença de hífen/travessão/maiúsculas
  ========================= */
  const activeMaterialsMap = new Map(); // key -> {pdf_url}

  function setAdminStatus(text, ok){
    const el = document.getElementById("admin-status");
    if (!el) return;
    el.innerText = text;
    el.classList.remove("ok","muted");
    el.classList.add(ok ? "ok" : "muted");
  }

  function normalizeKeyPart(str){
    const s = String(str || "")
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "");

    // troca qualquer travessão/en-dash/minus por hífen
    const d = s.replace(/[—–−]/g, "-");

    // normaliza espaços ao redor do hífen
    const spaced = d.replace(/\s*-\s*/g, " - ");

    // remove excesso de espaços
    return spaced.replace(/\s+/g, " ").trim();
  }

  function materialKey(category, cityLabel){
    return normalizeKeyPart(category) + "||" + normalizeKeyPart(cityLabel);
  }

  function hasActiveMaterial(category, cityLabel){
    return activeMaterialsMap.has(materialKey(category, cityLabel));
  }

  async function loadActiveMaterials(){
    activeMaterialsMap.clear();

    try{
      if (!window.supabase){
        setAdminStatus("Admin: falha na conexão", false);
        return;
      }

      ensureSupabase();

      const { data, error } = await supabaseClient
        .from("curadoria_materials")
        .select("category, city_label, pdf_url, is_active")
        .eq("is_active", true);

      if (error){
        setAdminStatus("Admin: erro ao carregar", false);
        return;
      }

      (data || []).forEach(row => {
        const key = materialKey(row.category || "", row.city_label || "");
        activeMaterialsMap.set(key, { pdf_url: row.pdf_url });
      });

      setAdminStatus("Admin: conectado", true);

      await maybeResumePendingCheckout();
    } catch(e){
      setAdminStatus("Admin: falha na conexão", false);
    }
  }

  async function maybeResumePendingCheckout(){
    const pending = readPendingCheckout();
    if (!pending || !pending.category || !pending.city) return;

    const token = await getAccessToken();
    if (!token) return;

    openPopup({
      title: "Continuar",
      text: "Deseja continuar o acesso do material selecionado?",
      showProsseguir: true,
      showRules: false,
      onProsseguir: () => {
        closePopup();
        pendingCheckout.category = pending.category;
        pendingCheckout.city = pending.city;
        clearPendingCheckout();
        proceedCheckout();
      }
    });
  }

  /* =========================
     Stripe: iniciar checkout
  ========================= */
  let pendingCheckout = { category:null, city:null };

  async function startCheckout(category, city){
    try{
      const token = await getAccessToken();

      // se não estiver logado: manda para login
      if (!token){
        savePendingCheckout(category, city);

        openPopup({
          title: "Acesso à conta",
          text: "Para prosseguir, é necessário entrar ou criar seu cadastro.",
          showProsseguir: true,
          showRules: false,
          onProsseguir: () => {
            window.location.href = "login.html?return_to=index.html";
          }
        });
        return;
      }

      const res = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ category, city })
      });

      let data = null;
      try{ data = await res.json(); }catch(e){}

      // invoice antes do Stripe
      if (data && data.code === "INVOICE_REQUIRED"){
        savePendingCheckout(category, city);

        openPopup({
          title: "Dados para Nota Fiscal",
          text: "Antes do pagamento, precisamos dessas informações.",
          showProsseguir: true,
          showRules: false,
          onProsseguir: () => {
            window.location.href =
              "checkout-success.html?step=invoice&category=" +
              encodeURIComponent(category) +
              "&city=" +
              encodeURIComponent(city);
          }
        });
        return;
      }

      // login obrigatório
      if (data && data.code === "LOGIN_REQUIRED"){
        savePendingCheckout(category, city);
        openPopup({
          title: "Acesso à conta",
          text: "Para prosseguir, é necessário entrar ou criar seu cadastro.",
          showProsseguir: true,
          showRules: false,
          onProsseguir: () => {
            window.location.href = "login.html?return_to=index.html";
          }
        });
        return;
      }

      // falha genérica
      if (!res.ok || !data || !data.url){
        openPopup({
          title: "Pagamento",
          text: "Não foi possível iniciar o pagamento. Tente novamente.",
          showProsseguir: false,
          showRules: false,
          onProsseguir: null
        });
        return;
      }

      // vai para o checkout da Stripe
      window.location.href = data.url;
    } catch(e){
      openPopup({
        title: "Pagamento",
        text: "Erro ao conectar com o pagamento. Tente novamente.",
        showProsseguir: false,
        showRules: false,
        onProsseguir: null
      });
    }
  }

  function proceedCheckout(){
    if (!pendingCheckout.category || !pendingCheckout.city) return;
    startCheckout(pendingCheckout.category, pendingCheckout.city);
  }

  /* =========================
     Painel de categorias + lista de cidades
  ========================= */
  const BATCH_SIZE = 8;
  let currentCategory = null;
  let filteredCities = [];
  let visibleCount = 0;

  function normalizeText(str){
    return (str || "")
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/[—–−]/g, "-");
  }

  function openCategory(category){
    currentCategory = category;

    const panel = document.getElementById("curadoria-panel");
    if (!panel) return;
    panel.style.display = "block";

    const bc = document.getElementById("breadcrumb");
    const pt = document.getElementById("panel-title");
    if (bc) bc.innerText = "Curadoria > " + category;
    if (pt) pt.innerText = category;

    const input = document.getElementById("city-search");
    if (input) input.value = "";

    filteredCities = (curadoriaData[category] || []).slice();
    visibleCount = Math.min(BATCH_SIZE, filteredCities.length);

    renderCities();

    setTimeout(() => {
      panel.scrollIntoView({ behavior: "smooth", block: "start" });
      if (input) input.focus({ preventScroll: true });
    }, 120);
  }

  function closeCategory(){
    const panel = document.getElementById("curadoria-panel");
    if (panel) panel.style.display = "none";
    currentCategory = null;
    filteredCities = [];
    visibleCount = 0;

    const cats = document.getElementById("curadoria-categories");
    if (cats) cats.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  function onSearchCity(){
    if (!currentCategory) return;

    const input = document.getElementById("city-search");
    const q = normalizeText(input ? input.value : "");
    const all = (curadoriaData[currentCategory] || []);

    if (!q) filteredCities = all.slice();
    else filteredCities = all.filter(item => normalizeText(item.cidade).includes(q));

    visibleCount = Math.min(BATCH_SIZE, filteredCities.length);
    renderCities();
  }

  function loadMoreCities(){
    visibleCount = Math.min(visibleCount + BATCH_SIZE, filteredCities.length);
    renderCities(true);
  }

  function renderCities(){
    const grid = document.getElementById("cities-grid");
    const empty = document.getElementById("empty-state");
    const btnMore = document.getElementById("btn-more");
    const citiesCount = document.getElementById("cities-count");
    const visible = document.getElementById("visible-count");

    if (!grid) return;

    const total = filteredCities.length;

    if (citiesCount) citiesCount.innerText = total + (total === 1 ? " cidade" : " cidades");
    if (visible) visible.innerText = "Mostrando " + Math.min(visibleCount, total);

    if (total === 0){
      grid.innerHTML = "";
      if (empty) empty.style.display = "block";
      if (btnMore) btnMore.style.display = "none";
      return;
    }

    if (empty) empty.style.display = "none";

    const slice = filteredCities.slice(0, visibleCount);
    grid.innerHTML = "";

    slice.forEach((item) => {
      const div = document.createElement("div");
      div.className = "city-card";

      const cityLabel = item.cidade || "";
      const isAvailable = hasActiveMaterial(currentCategory, cityLabel);

      const badge = isAvailable
        ? `<span class="pill ok">Disponível</span>`
        : `<span class="pill muted">Em breve</span>`;

      div.innerHTML = `
        <h4>${cityLabel}<small>Material digital com indicações selecionadas</small></h4>
        <div class="city-meta">${badge}</div>
        <button>Acessar</button>
      `;

      const btn = div.querySelector("button");
      btn.addEventListener("click", () => openCityModal(currentCategory, cityLabel));

      grid.appendChild(div);
    });

    if (btnMore){
      btnMore.style.display = visibleCount < total ? "inline-flex" : "none";
    }
  }

  function openCityModal(category, city){
    const isAvailable = hasActiveMaterial(category, city);

    pendingCheckout.category = category;
    pendingCheckout.city = city;

    const msg = isAvailable
      ? `${category} é um material digital com indicações e referências selecionadas para apoiar suas decisões de viagem. Este conteúdo é liberado após a confirmação da compra.`
      : `${category} é um material digital com indicações e referências selecionadas para apoiar suas decisões de viagem. Este conteúdo estará disponível em breve.`;

    if (!isAvailable){
      openPopup({
        title: city,
        text: msg,
        showProsseguir: false,
        showRules: true,
        onProsseguir: null
      });
      return;
    }

    openPopup({
      title: city,
      text: msg,
      showProsseguir: true,
      showRules: true,
      onProsseguir: proceedCheckout
    });
  }

  /* =========================
     Avaliação (placeholder)
  ========================= */
  let rating = 0;

  function initStars(){
    const wrap = document.getElementById("stars");
    if (!wrap) return;

    wrap.querySelectorAll(".star").forEach(st => {
      st.addEventListener("click", () => {
        rating = Number(st.getAttribute("data-v")) || 0;
        wrap.querySelectorAll(".star").forEach(s2 => {
          const v = Number(s2.getAttribute("data-v")) || 0;
          s2.classList.toggle("on", v <= rating);
        });
      });
    });
  }

  function fakeSendFeedback(){
    const name = (document.getElementById("fb-name")?.value || "").trim();
    const msg = (document.getElementById("fb-message")?.value || "").trim();

    openPopup({
      title: "Obrigado",
      text: "Recebemos sua mensagem. (Envio será integrado em breve.)",
      showProsseguir: false,
      showRules: false
    });

    // limpa campos
    try{
      document.getElementById("fb-name").value = "";
      document.getElementById("fb-message").value = "";
      const wrap = document.getElementById("stars");
      wrap.querySelectorAll(".star").forEach(s2 => s2.classList.remove("on"));
      rating = 0;
    }catch(e){}
  }

  /* =========================
     Inicialização
  ========================= */
  document.addEventListener("DOMContentLoaded", async () => {
    initBackgrounds();
    initStars();
    ensureSupabase();
    await updateAuthLinks();
    loadActiveMaterials();

    // Atualiza links de sessão se usuário fizer login em outra aba
    try{
      supabaseClient.auth.onAuthStateChange(async () => {
        await updateAuthLinks();
      });
    }catch(e){}
  });
</script>

</body>
</html>
